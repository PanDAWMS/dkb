============
* Stage 19 *
============

Description
-----------
Prepare data before uploading to ElasticSearch:
 * turn JSON keys to lower case
 * generate JSON with index information

Use ./run.sh to run stage with common configuration from
  /Utils/Elasticsearch/config/es

Input
-----
Expects data in JSON format with special fields.
Required:
* '_id' (ES record identifier);
* '_type' (ES record type).

Optional:
* '_parent' (ES identifier for parent type record).

Output
------
JSON documents, one document per line:
{{{
 <index info>
 <data>
}}}

Samples
-------
To produce regular (seamless NDJSON) samples, run:

  cat input/sample_name.ndjson | tr $'\n' $'\x1e' | \
    ./run.sh -E '' | tr -d $'\x1e' > output/sample_name.ndjson

Comment:
 * input samples can not be used (and output one -- saved) as-is
   due to the specific EOM marker (most of the stages use NEWLINE, which,
   being part of the output messages body, is not allowed here);
 * `tr` is a Unix utility to translate or delete characters (for details please
   refer to man pages);
 * output message body contains trailing NEWLINE, so RS is simply removed from
   the output stream (not replaced with another NEWLINE).

The 'output' directory contains two pairs of regular samples:

2016 data:
tasks2016.ndjson (from 016's 2016 sample)
datasets2016.ndjson (from 095's 2016 sample)

2018 data:
tasks2018.ndjson (from 016's 2018 sample)
datasets2018.ndjson (from 095's 2018 sample)

tasks* is the tasks' and input datasets' metadata.
datasets* is the output datasets' metadata.

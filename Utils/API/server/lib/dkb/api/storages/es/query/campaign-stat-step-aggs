{
  "status": {
    "terms": {
      "field": "status",
      "size": 20
    },
    "aggs": {
      "updated_24h": {
        "filter": {
          "range": {
            "task_timestamp": {"gte": "now-1d"}
          }
        },
        "aggs": {
          "finished": {
            "filter": {
              "terms": {"status": ["done", "finished"]}
            },
            "aggs": {
              "output": {
                "children": {"type": "output_dataset"},
                "aggs": {
                  "events": {
                    "sum": {"field": "events"}
                  }
                }
              },
              "processed_events": {
                "sum": {"field": "processed_events"}
              }
            }
          }
        }
      }
    }
  },
  "input_events": {
    "sum": {"field": "input_events"}
  },
  "output_events": {
    "children": {"type": "output_dataset"},
    "aggs": {
      "output_events": {
        "sum": {"field": "events"}
      }
    }
  },
  "finished": {
    "filter": {
      "terms": {"status": ["done", "finished"]}
    },
    "aggs": {
      "processed_events": {
        "sum": {"field": "processed_events"}
      }
    }
  },
  "start": {
    "min": {"field": "start_time"}
  },
  "end": {
    "max": {"field": "end_time"}
  }
}

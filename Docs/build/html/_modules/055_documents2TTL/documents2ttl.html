
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>055_documents2TTL.documents2ttl &#8212; Data Knowledge Base  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for 055_documents2TTL.documents2ttl</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Stage for converting JSON files(output of stage 015) into TTL files(input for</span>
<span class="sd">stage 060).</span>

<span class="sd">JSON file should have the following structure::</span>

<span class="sd">            {</span>
<span class="sd">              &quot;GLANCE&quot;: {},</span>
<span class="sd">              &quot;CDS&quot; : {},</span>
<span class="sd">              &quot;dkbID&quot; : ...,</span>
<span class="sd">              &quot;supporting_notes&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;GLANCE&quot;: {},</span>
<span class="sd">                        &quot;CDS&quot;: {},</span>
<span class="sd">                        &quot;dkbID&quot;: ...,</span>
<span class="sd">                    },</span>
<span class="sd">                    {</span>
<span class="sd">                        ...</span>
<span class="sd">                    }</span>
<span class="sd">              ]</span>
<span class="sd">            }</span>

<span class="sd">Resulting TTL file has the following structure::</span>

<span class="sd">            PAPER a atlas:Paper .</span>
<span class="sd">            PAPER atlas:hasGLANCE_ID __ .</span>
<span class="sd">            PAPER atlas:hasShortTitle __ .</span>
<span class="sd">            PAPER atlas:hasFullTitle __ .</span>
<span class="sd">            PAPER atlas:hasRefCode __ .</span>
<span class="sd">            PAPER atlas:hasCreationDate __ .</span>
<span class="sd">            PAPER atlas:hasCDSReportNumber __ .</span>
<span class="sd">            PAPER atlas:hasCDSInternal __ .</span>
<span class="sd">            PAPER atlas:hasCDS_ID __ .</span>
<span class="sd">            PAPER atlas:hasAbstract __ .</span>
<span class="sd">            PAPER atlas:hasArXivCode __ .</span>
<span class="sd">            PAPER atlas:hasFullTitle __ .</span>
<span class="sd">            PAPER atlas:hasDOI __ .</span>
<span class="sd">            PAPER atlas:hasKeyword __ .</span>
<span class="sd">            JOURNAL_ISSUE a atlas:JournalIssue .</span>
<span class="sd">            JOURNAL_ISSUE atlas:hasTitle __ .</span>
<span class="sd">            JOURNAL_ISSUE atlas:hasVolume __ .</span>
<span class="sd">            JOURNAL_ISSUE atlas:hasYear __ .</span>
<span class="sd">            JOURNAL_ISSUE atlas:containsPublication&gt; PAPER .</span>
<span class="sd">            SUPPORTING_DOCUMENT a atlas:SupportingDocument .</span>
<span class="sd">            SUPPORTING_DOCUMENT atlas:hasGLANCE_ID __ .</span>
<span class="sd">            SUPPORTING_DOCUMENT atlas:hasLabel __ .</span>
<span class="sd">            SUPPORTING_DOCUMENT atlas:hasURL __ .</span>
<span class="sd">            SUPPORTING_DOCUMENT atlas:hasCreationDate __ .</span>
<span class="sd">            SUPPORTING_DOCUMENT atlas:hasCDSInternal __ .</span>
<span class="sd">            SUPPORTING_DOCUMENT atlas:hasCDS_ID __ .</span>
<span class="sd">            SUPPORTING_DOCUMENT atlas:hasAbstract __ .</span>
<span class="sd">            SUPPORTING_DOCUMENT atlas:hasKeyword __ .</span>
<span class="sd">            PAPER atlas:isBasedOn SUPPORTING_DOCUMENT .</span>

<span class="sd">TODO: This module doesn&#39;t convert authors metadata.</span>
<span class="sd">      This task is still under consideration.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="n">dkb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dkb_dir</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">pyDKB</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;(ERROR) Failed to import pyDKB library: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># defaults</span>
<span class="n">GRAPH</span> <span class="o">=</span> <span class="s2">&quot;http://nosql.tpu.ru:8890/DAV/ATLAS&quot;</span>
<span class="n">ONTOLOGY</span> <span class="o">=</span> <span class="s2">&quot;http://nosql.tpu.ru/ontology/ATLAS&quot;</span>

<span class="c1"># Lists of dictionaries with parameters names for JSON documents</span>
<span class="c1"># and Ontology representation</span>

<span class="n">PAPER_GLANCE_ATTRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasGLANCE_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;^^xsd:int&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">:</span> <span class="s1">&#39;short_title&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasShortTitle&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">:</span> <span class="s1">&#39;full_title&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasFullTitle&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">:</span> <span class="s1">&#39;ref_code&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasRefCode&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">NOTE_GLANCE_ATTRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasGLANCE_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;^^xsd:int&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">:</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasLabel&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">:</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasURL&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
<span class="p">]</span>

<span class="n">PAPER_CDS_ATTRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;creation_date&#39;</span><span class="p">,</span>
     <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasCreationDate&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;^^xsd:dateTime&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;CDS_ReportNumber&#39;</span><span class="p">,</span>
     <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasCDSReportNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;CDSInternal&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasCDSInternal&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;CDS_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasCDS_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;^^xsd:integer&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasAbstract&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;primary_report_number&#39;</span><span class="p">,</span>
     <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasArXivCode&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasFullTitle&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
<span class="p">]</span>


<span class="n">NOTE_CDS_ATTRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;creation_date&#39;</span><span class="p">,</span>
     <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasCreationDate&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;^^xsd:dateTime&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;CDSInternal&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasCDSInternal&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;CDS_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasCDS_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;^^xsd:integer&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasAbstract&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;CDS&#39;</span><span class="p">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;ONTO&#39;</span><span class="p">:</span> <span class="s1">&#39;hasFullTitle&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
<span class="p">]</span>


<div class="viewcode-block" id="define_globals"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.define_globals">[docs]</a><span class="k">def</span> <span class="nf">define_globals</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">GRAPH</span>
    <span class="n">GRAPH</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">GRAPH</span>

    <span class="k">global</span> <span class="n">ONTOLOGY</span>
    <span class="n">ONTOLOGY</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ONTOLOGY</span></div>


<div class="viewcode-block" id="get_document_iri"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.get_document_iri">[docs]</a><span class="k">def</span> <span class="nf">get_document_iri</span><span class="p">(</span><span class="n">doc_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param doc_id:</span>
<span class="sd">    :return Document IRI for current graph:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;document/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">doc_id</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GRAPH</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>


<div class="viewcode-block" id="document_glance"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.document_glance">[docs]</a><span class="k">def</span> <span class="nf">document_glance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">doc_iri</span><span class="p">,</span> <span class="n">glance_attrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    converting document GLANCE metadata from JSON to TTL (Turtle)</span>
<span class="sd">    :param data: JSON data from file or stream</span>
<span class="sd">    :param doc_iri: document IRI</span>
<span class="sd">    :param glance_attrs: PAPER_GLANCE_ATTRS | NOTE_GLANCE_ATTRS</span>
<span class="sd">    :return ttl string with GLANCE metadata:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if isinstance(data, dict):</span>
    <span class="c1">#     raise ValueError(&quot;expected parameter of type %s,&quot;</span>
    <span class="c1">#                      &quot; got %s\n&quot; % (dict, type(data)))</span>
    <span class="n">ttl</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">glance_attrs</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">glance_parameter_extraction</span><span class="p">(</span>
            <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">glance_attrs</span><span class="p">:</span>
        <span class="n">curr_value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">)]</span>
        <span class="n">ttl</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{docIRI}</span><span class="s1"> &lt;</span><span class="si">{ontology}</span><span class="s1">#</span><span class="si">{ONTO}</span><span class="s1">&gt; &quot;</span><span class="si">{value}</span><span class="s1">&quot;</span><span class="si">{xsdType}</span><span class="s1"> .</span><span class="se">\n</span><span class="s1">&#39;</span> \
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docIRI</span><span class="o">=</span><span class="n">doc_iri</span><span class="p">,</span> <span class="n">ontology</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">,</span> <span class="n">ONTO</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ONTO&#39;</span><span class="p">),</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">curr_value</span><span class="p">,</span> <span class="n">xsdType</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TYPE&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ttl</span></div>


<div class="viewcode-block" id="documents_links"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.documents_links">[docs]</a><span class="k">def</span> <span class="nf">documents_links</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert documents links to TTL</span>
<span class="sd">    :param data: metadata fro JSON file or stream</span>
<span class="sd">    :return ttl: ttl string with links</span>
<span class="sd">    PAPER atlas:isBasedOn SUPPORTING_DOCUMENT .</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ttl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">paper_iri</span> <span class="o">=</span> <span class="n">get_document_iri</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dkbID&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;supporting_notes&#39;</span><span class="p">):</span>
        <span class="n">note_iri</span> <span class="o">=</span> <span class="n">get_document_iri</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dkbID&#39;</span><span class="p">))</span>
        <span class="n">ttl</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{paperIRI}</span><span class="s1"> &lt;</span><span class="si">{ontology}</span><span class="s1">#isBasedOn&gt; </span><span class="si">{noteIRI}</span><span class="s1"> .</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paperIRI</span><span class="o">=</span><span class="n">paper_iri</span><span class="p">,</span> <span class="n">ontology</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">,</span> <span class="n">noteIRI</span><span class="o">=</span><span class="n">note_iri</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ttl</span></div>


<div class="viewcode-block" id="document_cds"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.document_cds">[docs]</a><span class="k">def</span> <span class="nf">document_cds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">doc_iri</span><span class="p">,</span> <span class="n">cds_attrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read JSON document with supporting document metadata and generating TTL</span>
<span class="sd">    :param data: metadata fro JSON file or stream</span>
<span class="sd">    :param doc_iri: document IRI for current graph</span>
<span class="sd">    :param cds_attrs: PAPER_CDS_ATTRS | NOTE_CDS_ATTRS</span>
<span class="sd">    :return ttl: string with metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ttl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">cds_attrs</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CDS&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cds_parameter_extraction</span><span class="p">(</span>
            <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CDS&#39;</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cds_attrs</span><span class="p">:</span>
        <span class="n">curr_value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CDS&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">curr_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ttl</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{docIRI}</span><span class="s1"> &lt;</span><span class="si">{ontology}</span><span class="s1">#</span><span class="si">{ONTO}</span><span class="s1">&gt; &quot;</span><span class="si">{value}</span><span class="s1">&quot;</span><span class="si">{xsdType}</span><span class="s1"> .</span><span class="se">\n</span><span class="s1">&#39;</span> \
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docIRI</span><span class="o">=</span><span class="n">doc_iri</span><span class="p">,</span> <span class="n">ontology</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">,</span>
                        <span class="n">ONTO</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ONTO&#39;</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="n">curr_value</span><span class="p">,</span>
                        <span class="n">xsdType</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TYPE&#39;</span><span class="p">))</span>
    <span class="c1"># processing multivalue parameters</span>
    <span class="k">if</span> <span class="s1">&#39;doi&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">ttl</span> <span class="o">+=</span> <span class="n">doi2ttl</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;doi&#39;</span><span class="p">),</span> <span class="n">doc_iri</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;keywords&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">ttl</span> <span class="o">+=</span> <span class="n">keywords2ttl</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keywords&#39;</span><span class="p">),</span> <span class="n">doc_iri</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;publication_info&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">ttl</span> <span class="o">+=</span> <span class="n">process_journals</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;publication_info&#39;</span><span class="p">),</span> <span class="n">doc_iri</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;done!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ttl</span></div>


<div class="viewcode-block" id="doi2ttl"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.doi2ttl">[docs]</a><span class="k">def</span> <span class="nf">doi2ttl</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="n">doc_iri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converting DOI parameter to TTL</span>
<span class="sd">    :param doi: doi from JSON string</span>
<span class="sd">    :param doc_iri: document IRI for current graph</span>
<span class="sd">    :return ttl: ttl string with DOIs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ttl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">dois</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
        <span class="n">dois</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doi</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">dois</span> <span class="o">=</span> <span class="n">doi</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fix_list_values</span><span class="p">(</span><span class="n">dois</span><span class="p">):</span>
        <span class="n">ttl</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{docIRI}</span><span class="s1"> &lt;</span><span class="si">{ontology}</span><span class="s1">#hasDOI&gt; &quot;</span><span class="si">{doi}</span><span class="s1">&quot; .</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docIRI</span><span class="o">=</span><span class="n">doc_iri</span><span class="p">,</span> <span class="n">doi</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">ontology</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ttl</span></div>


<div class="viewcode-block" id="keywords2ttl"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.keywords2ttl">[docs]</a><span class="k">def</span> <span class="nf">keywords2ttl</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="n">doc_iri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converting keywords from JSON string to TTL</span>
<span class="sd">    :param keywords: keywords parameters from JSON string</span>
<span class="sd">    :param doc_iri: document IRI for current graph</span>
<span class="sd">    :return ttl: ttl string with keywords</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ttl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">keyword</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;term&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">keywords</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;term&#39;</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">splitted</span> <span class="o">=</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;term&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitted</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">keyword</span> <span class="o">=</span> <span class="n">splitted</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keyword</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;term&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">keyword</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;term&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fix_list_values</span><span class="p">(</span><span class="n">keyword</span><span class="p">):</span>
        <span class="n">ttl</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{docIRI}</span><span class="s1"> &lt;</span><span class="si">{ontology}</span><span class="s1">#hasKeyword&gt; &quot;</span><span class="si">{keyword}</span><span class="s1">&quot; .</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docIRI</span><span class="o">=</span><span class="n">doc_iri</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">ontology</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ttl</span></div>


<div class="viewcode-block" id="cds_internal_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.cds_internal_extraction">[docs]</a><span class="k">def</span> <span class="nf">cds_internal_extraction</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracting cds internal report number parameter from JSON string</span>
<span class="sd">    :param data: JSON string</span>
<span class="sd">    :return report number:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;report_number&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">report_number</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report_number&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">report_number</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">report_number</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;internal&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;internal&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">report_number</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;internal&#39;</span> <span class="ow">in</span> <span class="n">report_number</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">report_number</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;internal&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;internal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">report_number</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;primary_report_number&#39;</span> <span class="ow">in</span> <span class="n">report_number</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">report_number</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;primary_report_number&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="report_number_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.report_number_extraction">[docs]</a><span class="k">def</span> <span class="nf">report_number_extraction</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exracting report number from JSON string</span>
<span class="sd">    :param data:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;report_number&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">report_number</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report_number&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">report_number</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">report_number</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;report_number&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report_number&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">report_number</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;report_number&#39;</span> <span class="ow">in</span> <span class="n">report_number</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">report_number</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;report_number&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="glance_parameter_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.glance_parameter_extraction">[docs]</a><span class="k">def</span> <span class="nf">glance_parameter_extraction</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracting single value parameters from GLANCE json</span>
<span class="sd">    :param param_name:</span>
<span class="sd">    :param json_data: JSON with GLANCE metadata</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;short_title&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;short_title&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;full_title&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_title&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;ref_code&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_code&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="cds_parameter_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.cds_parameter_extraction">[docs]</a><span class="k">def</span> <span class="nf">cds_parameter_extraction</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracting parameters from json string with CDS parameters</span>
<span class="sd">    :param param_name: name of parameter, defined in *_CDS_ATTRS dict</span>
<span class="sd">    :param json_data: json string with CDS parameters</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;abstract&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">abstract_extraction</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">title_extraction</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;CDS_ID&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cds_id_extraction</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;creation_date&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">creation_date_extraction</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;primary_report_number&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arxiv_extraction</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;CDSInternal&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cds_internal_extraction</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s1">&#39;CDS_ReportNumber&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">report_number_extraction</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="abstract_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.abstract_extraction">[docs]</a><span class="k">def</span> <span class="nf">abstract_extraction</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracting abstract from json string</span>
<span class="sd">    :param data: json string</span>
<span class="sd">    :return: string with abstract</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s1">&#39;abstract&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">abstract</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">abstract</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">abstract</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">abstr</span> <span class="ow">in</span> <span class="n">abstract</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">abstr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="s1">&#39;summary&#39;</span> <span class="ow">in</span> <span class="n">abstr</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">abstr</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">]</span>
                    <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;(WARN) Failed to extract abstract summary.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="title_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.title_extraction">[docs]</a><span class="k">def</span> <span class="nf">title_extraction</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracting title from json string</span>
<span class="sd">    :param data: json string</span>
<span class="sd">    :return: string with title</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="cds_id_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.cds_id_extraction">[docs]</a><span class="k">def</span> <span class="nf">cds_id_extraction</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracting CDS_ID from json string</span>
<span class="sd">    :param data: json string</span>
<span class="sd">    :return: string with CDS_ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;recid&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recid&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="creation_date_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.creation_date_extraction">[docs]</a><span class="k">def</span> <span class="nf">creation_date_extraction</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracting creation date from json string</span>
<span class="sd">    :param data: json string</span>
<span class="sd">    :return: string with date</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;creation_date&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;creation_date&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="arxiv_extraction"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.arxiv_extraction">[docs]</a><span class="k">def</span> <span class="nf">arxiv_extraction</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracting of arXiv from json string</span>
<span class="sd">    :param data: json string</span>
<span class="sd">    :return: string with arXiv</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;primary_report_number&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">report_number</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;primary_report_number&#39;</span><span class="p">)</span>
        <span class="c1"># primary_report_number can be string, unicode and list</span>
        <span class="c1"># if we don&#39;t find any string, started with &#39;arXiv&#39; -</span>
        <span class="c1"># it means that there is no arXiv code and</span>
        <span class="c1"># we don&#39;t need to add it to TTL</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">report_number</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">report_number</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;arXiv&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">report_number</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">report_number</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">report_number</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;arXiv&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">fix_string</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="generate_journal_id"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.generate_journal_id">[docs]</a><span class="k">def</span> <span class="nf">generate_journal_id</span><span class="p">(</span><span class="n">journal_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generating journal issue ID based on title, volume and year</span>
<span class="sd">    :param journal_dict: dictionary with journal parameters</span>
<span class="sd">    :return: journal ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">journal_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">journal_dict</span><span class="p">:</span>
        <span class="n">journal_id</span> <span class="o">+=</span> <span class="n">journal_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;volume&#39;</span> <span class="ow">in</span> <span class="n">journal_dict</span><span class="p">:</span>
        <span class="n">journal_id</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">journal_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">journal_dict</span><span class="p">:</span>
        <span class="n">journal_id</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">journal_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">journal_id</span></div>


<div class="viewcode-block" id="process_journals"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.process_journals">[docs]</a><span class="k">def</span> <span class="nf">process_journals</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">doc_iri</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert journal data from json string to TTL</span>
<span class="sd">    :param data: json string</span>
<span class="sd">    :param doc_iri: document IRI for current graph</span>
<span class="sd">    :return: ttl string with journal issue with connection to paper</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">journals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">journals</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">journals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ttl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">journals</span><span class="p">:</span>
        <span class="n">journal_id</span> <span class="o">=</span> <span class="n">generate_journal_id</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">ttl</span> <span class="o">+=</span> <span class="s1">&#39;&lt;</span><span class="si">{journal_resource}{journalIssueID}</span><span class="s1">&gt;&#39;</span>\
            <span class="s1">&#39; a &lt;</span><span class="si">{ontology}</span><span class="s1">#JournalIssue&gt; .</span><span class="se">\n</span><span class="s1">&#39;</span> \
            <span class="s1">&#39;&lt;</span><span class="si">{journal_resource}{journalIssueID}</span><span class="s1">&gt;&#39;</span>\
            <span class="s1">&#39; &lt;</span><span class="si">{ontology}</span><span class="s1">#hasTitle&gt; &quot;</span><span class="si">{title}</span><span class="s1">&quot;^^xsd:string .</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;&lt;</span><span class="si">{journal_resource}{journalIssueID}</span><span class="s1">&gt;&#39;</span>\
            <span class="s1">&#39; &lt;</span><span class="si">{ontology}</span><span class="s1">#hasVolume&gt; &quot;</span><span class="si">{volume}</span><span class="s1">&quot;^^xsd:string .</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;&lt;</span><span class="si">{journal_resource}{journalIssueID}</span><span class="s1">&gt;&#39;</span>\
            <span class="s1">&#39; &lt;</span><span class="si">{ontology}</span><span class="s1">#hasYear&gt; &quot;</span><span class="si">{year}</span><span class="s1">&quot;^^xsd:string .</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;&lt;</span><span class="si">{journal_resource}{journalIssueID}</span><span class="s1">&gt;&#39;</span>\
            <span class="s1">&#39; &lt;</span><span class="si">{ontology}</span><span class="s1">#containsPublication&gt; </span><span class="si">{doc_iri}</span><span class="s1"> .</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">journalIssueID</span><span class="o">=</span><span class="n">journal_id</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
                    <span class="n">volume</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">),</span> <span class="n">year</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">),</span>
                    <span class="n">doc_iri</span><span class="o">=</span><span class="n">doc_iri</span><span class="p">,</span>
                    <span class="n">journal_resource</span><span class="o">=</span><span class="n">GRAPH</span> <span class="o">+</span> <span class="s1">&#39;/journal_issue/&#39;</span><span class="p">,</span>
                    <span class="n">ontology</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ttl</span></div>


<div class="viewcode-block" id="fix_string"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.fix_string">[docs]</a><span class="k">def</span> <span class="nf">fix_string</span><span class="p">(</span><span class="n">wrong_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fix escape sequences in strings</span>
<span class="sd">    :param wrong_string:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wrong_string</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">wrong_string</span>
    <span class="k">return</span> <span class="n">wrong_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&#39;&quot;</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="fix_list_values"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.fix_list_values">[docs]</a><span class="k">def</span> <span class="nf">fix_list_values</span><span class="p">(</span><span class="n">list_vals</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fixing list values with fix_string</span>
<span class="sd">    :param list_vals:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">list_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">fix_string</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_vals</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">list_vals</span></div>


<div class="viewcode-block" id="process"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.process">[docs]</a><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">stage</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processing messages from JSON to TTL</span>
<span class="sd">    :param stage: instance of ProcessorStage</span>
<span class="sd">    :param msg: input JSON message</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">()</span>
    <span class="n">paper_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dkbID&#39;</span><span class="p">)</span>

    <span class="c1"># papers processing</span>

    <span class="n">doc_iri</span> <span class="o">=</span> <span class="n">get_document_iri</span><span class="p">(</span><span class="n">paper_id</span><span class="p">)</span>
    <span class="n">doc_ttl</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">doc_ttl</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{docIRI}</span><span class="s1"> a &lt;</span><span class="si">{ontology}</span><span class="s1">#Paper&gt; .</span><span class="se">\n</span><span class="s1">&#39;</span> \
        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docIRI</span><span class="o">=</span><span class="n">doc_iri</span><span class="p">,</span> <span class="n">ontology</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">)</span>
    <span class="n">doc_ttl</span> <span class="o">+=</span> <span class="n">document_glance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">),</span> <span class="n">doc_iri</span><span class="p">,</span> <span class="n">PAPER_GLANCE_ATTRS</span><span class="p">)</span>
    <span class="n">doc_ttl</span> <span class="o">+=</span> <span class="n">document_cds</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CDS&#39;</span><span class="p">),</span> <span class="n">doc_iri</span><span class="p">,</span> <span class="n">PAPER_CDS_ATTRS</span><span class="p">)</span>

    <span class="c1"># supporting documents processing</span>

    <span class="k">if</span> <span class="s2">&quot;supporting_notes&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;supporting_notes&#39;</span><span class="p">):</span>
            <span class="n">note_id</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dkbID&#39;</span><span class="p">)</span>
            <span class="n">note_iri</span> <span class="o">=</span> <span class="n">get_document_iri</span><span class="p">(</span><span class="n">note_id</span><span class="p">)</span>
            <span class="n">doc_ttl</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{noteIRI}</span><span class="s1"> a &lt;</span><span class="si">{ontology}</span><span class="s1">#SupportingDocument&gt; .</span><span class="se">\n</span><span class="s1">&#39;</span> \
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">noteIRI</span><span class="o">=</span><span class="n">note_iri</span><span class="p">,</span> <span class="n">ontology</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">)</span>
            <span class="n">doc_ttl</span> <span class="o">+=</span> <span class="n">document_glance</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GLANCE&#39;</span><span class="p">),</span>
                                       <span class="n">note_iri</span><span class="p">,</span> <span class="n">NOTE_GLANCE_ATTRS</span><span class="p">)</span>
            <span class="n">doc_ttl</span> <span class="o">+=</span> <span class="n">document_cds</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CDS&#39;</span><span class="p">),</span> <span class="n">note_iri</span><span class="p">,</span> <span class="n">NOTE_CDS_ATTRS</span><span class="p">)</span>

    <span class="n">doc_ttl</span> <span class="o">+=</span> <span class="n">documents_links</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">doc_ttl</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">stage</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">pyDKB</span><span class="o">.</span><span class="n">dataflow</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span>
            <span class="n">pyDKB</span><span class="o">.</span><span class="n">dataflow</span><span class="o">.</span><span class="n">messageType</span><span class="o">.</span><span class="n">TTL</span><span class="p">)(</span><span class="n">item</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../055_documents2TTL/055_documents2TTL.html#055_documents2TTL.documents2ttl.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parsing command line arguments and processing JSON string</span>
<span class="sd">    from file or from stream</span>

<span class="sd">    :param argv: arguments</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exit_code</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">exc_info</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">stage</span> <span class="o">=</span> <span class="n">pyDKB</span><span class="o">.</span><span class="n">dataflow</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">ProcessorStage</span><span class="p">()</span>
    <span class="n">stage</span><span class="o">.</span><span class="n">set_input_message_type</span><span class="p">(</span><span class="n">pyDKB</span><span class="o">.</span><span class="n">dataflow</span><span class="o">.</span><span class="n">messageType</span><span class="o">.</span><span class="n">JSON</span><span class="p">)</span>
    <span class="n">stage</span><span class="o">.</span><span class="n">set_output_message_type</span><span class="p">(</span><span class="n">pyDKB</span><span class="o">.</span><span class="n">dataflow</span><span class="o">.</span><span class="n">messageType</span><span class="o">.</span><span class="n">TTL</span><span class="p">)</span>
    <span class="n">stage</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="n">process</span>
    <span class="n">stage</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-g&#39;</span><span class="p">,</span> <span class="s1">&#39;--graph&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                       <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Virtuoso DB graph name (default:&#39;</span>
                            <span class="s1">&#39; </span><span class="si">%(default)s</span><span class="s1">)&#39;</span><span class="p">,</span>
                       <span class="n">default</span><span class="o">=</span><span class="n">GRAPH</span><span class="p">,</span>
                       <span class="n">const</span><span class="o">=</span><span class="n">GRAPH</span><span class="p">,</span>
                       <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;GRAPH&#39;</span><span class="p">,</span>
                       <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;GRAPH&#39;</span><span class="p">)</span>
    <span class="n">stage</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-O&#39;</span><span class="p">,</span> <span class="s1">&#39;--ontology&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                       <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Virtuoso ontology prefix (default:&#39;</span>
                            <span class="s1">&#39; </span><span class="si">%(default)s</span><span class="s1">)&#39;</span><span class="p">,</span>
                       <span class="n">default</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">,</span>
                       <span class="n">const</span><span class="o">=</span><span class="n">ONTOLOGY</span><span class="p">,</span>
                       <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;ONT&#39;</span><span class="p">,</span>
                       <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;ONTOLOGY&#39;</span><span class="p">)</span>
    <span class="n">stage</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">define_globals</span><span class="p">(</span><span class="n">stage</span><span class="o">.</span><span class="n">ARGS</span><span class="p">)</span>
    <span class="n">exit_code</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stage</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="n">exit</span><span class="p">(</span><span class="n">exit_code</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Data Knowledge Base</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pyDKB/pyDKB.html">pyDKB package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../055_documents2TTL/055_documents2TTL.html">Stage 055</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, DKB team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>